df_todos_fiis %>%
dplyr::group_by(Setor) %>%
dplyr::summarise(
n = n(),
DY12m_median = median(DY12m, na.rm=TRUE),
MM200Delta_median = median(MM200Delta, na.rm=TRUE)
) %>% dplyr::filter(n >= 2) %>% dplyr::arrange(desc(MM200Delta_median)) %>% print(n = Inf)
blogdown::serve_site()
knitr::opts_chunk$set(collapse = TRUE,
fig.retina = 2,
fig.align = 'center')
library(emo)
Tabela_Dinamica = df_todos_fiis %>%
dplyr::group_by(Setor) %>%
dplyr::summarise(
n = n(),
DY12m_median = median(DY12m, na.rm=TRUE),
MM200Delta_median = median(MM200Delta, na.rm=TRUE)
) %>% dplyr::filter(n >= 2) %>% dplyr::arrange(desc(MM200Delta_median)) %>% print(n = Inf)
print(Tabela_Dinamica)
Tabela_Dinamica
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=23)
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=23) +
geom_text(label=Setor)
as.data.frame(Tabela_Dinamica)
ggplot(as.data.frame(Tabela_Dinamica), aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=23) +
geom_text(label=Setor)
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=23) +
geom_text(label=n)
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=23) +
geom_text(label=Tabela_Dinamica$Setor)
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=23) +
geom_text(label=Tabela_Dinamica$Setor) +
xlab('Dividend Yield') +
ylab('MM200Delta')
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median, label = Tabela_Dinamica$Setor)) +
geom_point(size=2, shape=23) +
xlab('Dividend Yield') +
ylab('MM200Delta')
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median, label = Setor)) +
geom_point(size=2, shape=23) +
xlab('Dividend Yield') +
ylab('MM200Delta')
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=23) +
geom_text(label=Tabela_Dinamica$Setor) +
xlab('Dividend Yield') +
ylab('MM200Delta')
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=23) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0, vjust=0) +
xlab('Dividend Yield') +
ylab('MM200Delta')
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=23) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0, vjust=1) +
xlab('Dividend Yield') +
ylab('MM200Delta')
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=23) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0, vjust=2) +
xlab('Dividend Yield') +
ylab('MM200Delta')
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=23) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0, vjust=1.5) +
xlab('Dividend Yield') +
ylab('MM200Delta')
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=23) +
geom_text(label=Tabela_Dinamica$Setor, hjust=1, vjust=1.5) +
xlab('Dividend Yield') +
ylab('MM200Delta')
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=23) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0.2, vjust=1.5) +
xlab('Dividend Yield') +
ylab('MM200Delta')
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=23) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0.4, vjust=1.5) +
xlab('Dividend Yield') +
ylab('MM200Delta')
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=23) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0.45, vjust=1.5) +
xlab('Dividend Yield') +
ylab('MM200Delta')
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=23) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0.45, vjust=1.5) +
xlab('Dividend Yield') +
ylab('MM200Delta') +
geom_hline(yintercept=100, linetype="dashed",color = "black", size=2)
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=23) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0.45, vjust=1.5) +
xlab('Dividend Yield') +
ylab('MM200Delta') +
geom_hline(yintercept=100, linetype="dashed",color = "black", size=0.2)
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=23) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0.45, vjust=1.5) +
xlab('Dividend Yield') +
ylab('MM200Delta') +
geom_hline(yintercept=100, linetype="dashed",color = "black", size=0.2, alpha = .4)
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=23) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0.45, vjust=1.5) +
xlab('Dividend Yield') +
ylab('MM200Delta') +
geom_hline(yintercept=100, linetype="dashed",color = "black", size=0.5, alpha = .4)
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=23) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0.45, vjust=1.5) +
xlab('Dividend Yield') +
ylab('MM200Delta') +
geom_hline(yintercept=100, linetype="dashed",color = "black", size=0.5, alpha = .4) +
geom_vline(yintercept=5, linetype="dashed",color = "black", size=0.5, alpha = .4)
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=23) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0.45, vjust=1.5) +
xlab('Dividend Yield') +
ylab('MM200Delta') +
geom_hline(yintercept=100, linetype="dashed",color = "black", size=0.5, alpha = .4) +
geom_vline(xintercept=5, linetype="dashed",color = "black", size=0.5, alpha = .4)
coord_cartesian(xlim = c(0, 12)
)
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=23) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0.45, vjust=1.5) +
xlab('Dividend Yield') +
ylab('MM200Delta') +
geom_hline(yintercept=100, linetype="dashed",color = "black", size=0.5, alpha = .4) +
geom_vline(xintercept=5, linetype="dashed",color = "black", size=0.5, alpha = .4) +
coord_cartesian(xlim = c(0, 12))
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=23) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0.45, vjust=1.5) +
xlab('Dividend Yield') +
ylab('MM200Delta') +
geom_hline(yintercept=100, linetype="dashed",color = "black", size=0.5, alpha = .4) +
geom_vline(xintercept=5, linetype="dashed",color = "black", size=0.5, alpha = .4) +
coord_cartesian(xlim = c(0, 11))
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=1) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0.45, vjust=1.5) +
xlab('Dividend Yield') +
ylab('MM200Delta') +
geom_hline(yintercept=100, linetype="dashed",color = "black", size=0.5, alpha = .4) +
geom_vline(xintercept=5, linetype="dashed",color = "black", size=0.5, alpha = .4) +
coord_cartesian(xlim = c(0, 11))
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=1) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0.45, vjust=1.5) +
xlab('Dividend Yield') +
ylab('MM200Delta') +
geom_hline(yintercept=100, linetype="dashed",color = "black", size=0.5, alpha = .4) +
geom_vline(xintercept=5, linetype="dashed",color = "black", size=0.5, alpha = .4) +
coord_cartesian(xlim = c(0, 11)) +
geom_segment(aes(x = 9, y = 105, xend = 10, yend = 107.5),
arrow = arrow(length = unit(0.5, "cm")))
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=1) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0.45, vjust=1.5) +
xlab('Dividend Yield') +
ylab('MM200Delta') +
geom_hline(yintercept=100, linetype="dashed",color = "black", size=0.5, alpha = .4) +
geom_vline(xintercept=5, linetype="dashed",color = "black", size=0.5, alpha = .4) +
coord_cartesian(xlim = c(0, 11)) +
geom_segment(aes(x = 9, y = 105, xend = 10, yend = 107.5),
arrow = arrow(length = unit(0.5, "cm", colour = "red")))
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=1) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0.45, vjust=1.5) +
xlab('Dividend Yield') +
ylab('MM200Delta') +
geom_hline(yintercept=100, linetype="dashed",color = "black", size=0.5, alpha = .4) +
geom_vline(xintercept=5, linetype="dashed",color = "black", size=0.5, alpha = .4) +
coord_cartesian(xlim = c(0, 11)) +
geom_segment(aes(x = 9, y = 105, xend = 10, yend = 107.5, colour = "red"),
arrow = arrow(length = unit(0.5, "cm",)))
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=1) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0.45, vjust=1.5) +
xlab('Dividend Yield') +
ylab('MM200Delta') +
geom_hline(yintercept=100, linetype="dashed",color = "black", size=0.5, alpha = .4) +
geom_vline(xintercept=5, linetype="dashed",color = "black", size=0.5, alpha = .4) +
coord_cartesian(xlim = c(0, 11)) +
geom_segment(aes(x = 9, y = 105, xend = 10, yend = 107.5, colour = "red", size = 2),
arrow = arrow(length = unit(0.5, "cm",)))
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=1) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0.45, vjust=1.5) +
xlab('Dividend Yield') +
ylab('MM200Delta') +
geom_hline(yintercept=100, linetype="dashed",color = "black", size=0.5, alpha = .4) +
geom_vline(xintercept=5, linetype="dashed",color = "black", size=0.5, alpha = .4) +
coord_cartesian(xlim = c(0, 11)) +
geom_segment(aes(x = 9, y = 105, xend = 10, yend = 107.5, colour = "red", size = 1.5),
arrow = arrow(length = unit(0.5, "cm",)))
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=1) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0.45, vjust=1.5) +
xlab('Dividend Yield') +
ylab('MM200Delta') +
geom_hline(yintercept=100, linetype="dashed",color = "black", size=0.5, alpha = .4) +
geom_vline(xintercept=5, linetype="dashed",color = "black", size=0.5, alpha = .4) +
coord_cartesian(xlim = c(0, 11)) +
geom_segment(aes(x = 9, y = 105, xend = 10, yend = 107.5, colour = "red", size = 1.5),
arrow = arrow(length = unit(0.5, "cm",)))
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=1) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0.45, vjust=1.5) +
xlab('Dividend Yield') +
ylab('MM200Delta') +
geom_hline(yintercept=100, linetype="dashed",color = "black", size=0.5, alpha = .4) +
geom_vline(xintercept=5, linetype="dashed",color = "black", size=0.5, alpha = .4) +
coord_cartesian(xlim = c(0, 11)) +
geom_segment(aes(x = 9, y = 105, xend = 10, yend = 107.5, colour = "red"),
arrow = arrow(length = unit(0.5, "cm",)))
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=1) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0.45, vjust=1.5) +
xlab('Dividend Yield') +
ylab('MM200Delta') +
geom_hline(yintercept=100, linetype="dashed",color = "black", size=0.5, alpha = .4) +
geom_vline(xintercept=5, linetype="dashed",color = "black", size=0.5, alpha = .4) +
coord_cartesian(xlim = c(0, 11)) +
geom_segment(aes(x = 9, y = 105, xend = 10, yend = 107.5),
arrow = arrow(length = unit(0.5, "cm",)))
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=1) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0.45, vjust=1.5) +
xlab('Dividend Yield') +
ylab('MM200Delta') +
geom_hline(yintercept=100, linetype="dashed",color = "black", size=0.5, alpha = .4) +
geom_vline(xintercept=5, linetype="dashed",color = "black", size=0.5, alpha = .4) +
coord_cartesian(xlim = c(0, 11)) +
geom_segment(aes(x = 9, y = 105, xend = 10, yend = 107.5), color = "red"
arrow = arrow(length = unit(0.5, "cm",)))
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=1) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0.45, vjust=1.5) +
xlab('Dividend Yield') +
ylab('MM200Delta') +
geom_hline(yintercept=100, linetype="dashed",color = "black", size=0.5, alpha = .4) +
geom_vline(xintercept=5, linetype="dashed",color = "black", size=0.5, alpha = .4) +
coord_cartesian(xlim = c(0, 11)) +
geom_segment(aes(x = 9, y = 105, xend = 10, yend = 107.5), color = "red",
arrow = arrow(length = unit(0.5, "cm",)))
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=1) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0.45, vjust=1.5) +
xlab('Dividend Yield') +
ylab('MM200Delta') +
geom_hline(yintercept=100, linetype="dashed",color = "black", size=0.5, alpha = .4) +
geom_vline(xintercept=5, linetype="dashed",color = "black", size=0.5, alpha = .4) +
coord_cartesian(xlim = c(0, 11)) +
geom_segment(aes(x = 9, y = 105, xend = 10, yend = 107.5), color = "red", size = 1.5,
arrow = arrow(length = unit(0.5, "cm",)))
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=1) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0.45, vjust=1.5) +
xlab('Dividend Yield') +
ylab('MM200Delta') +
geom_hline(yintercept=100, linetype="dashed",color = "black", size=0.5, alpha = .4) +
geom_vline(xintercept=5, linetype="dashed",color = "black", size=0.5, alpha = .4) +
coord_cartesian(xlim = c(0, 11)) +
geom_segment(aes(x = 9, y = 105, xend = 11, yend = 107.5), color = "red", size = 1.5,
arrow = arrow(length = unit(0.5, "cm",)))
ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=1) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0.45, vjust=1.5) +
xlab('Dividend Yield') +
ylab('MM200Delta') +
geom_hline(yintercept=100, linetype="dashed",color = "black", size=0.5, alpha = .4) +
geom_vline(xintercept=5, linetype="dashed",color = "black", size=0.5, alpha = .4) +
coord_cartesian(xlim = c(0, 11)) +
geom_segment(aes(x = 9, y = 105, xend = 10.5, yend = 107.5), color = "red", size = 1.5,
arrow = arrow(length = unit(0.5, "cm",)))
g = ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=1) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0.45, vjust=1.5) +
xlab('Dividend Yield') +
ylab('MM200Delta') +
geom_hline(yintercept=100, linetype="dashed",color = "black", size=0.5, alpha = .4) +
geom_vline(xintercept=5, linetype="dashed",color = "black", size=0.5, alpha = .4) +
coord_cartesian(xlim = c(0, 11)) +
geom_segment(aes(x = 9, y = 105, xend = 10.5, yend = 107.5), color = "red", size = 1.5,
arrow = arrow(length = unit(0.5, "cm",)))
print(g)
g = ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=1) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0.45, vjust=1.5) +
xlab('Dividend Yield') +
ylab('MM200Delta') +
geom_hline(yintercept=100, linetype="dashed",color = "black", size=0.5, alpha = .4) +
geom_vline(xintercept=5, linetype="dashed",color = "black", size=0.5, alpha = .4) +
coord_cartesian(xlim = c(0, 11)) +
geom_segment(aes(x = 9, y = 105, xend = 10.5, yend = 107.5), color = "red", size = 1.5,
arrow = arrow(length = unit(0.5, "cm",)))
print(g)
g = ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=1) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0.45, vjust=1.5) +
xlab('Dividend Yield') +
ylab('MM200Delta') +
geom_hline(yintercept=100, linetype="dashed",color = "black", size=0.5, alpha = .4) +
geom_vline(xintercept=5, linetype="dashed",color = "black", size=0.5, alpha = .4) +
coord_cartesian(xlim = c(0, 11))
print(g)
g = ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=1) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0.45, vjust=1.5) +
xlab('Dividend Yield') +
ylab('MM200Delta') +
geom_hline(yintercept=100, linetype="dashed",color = "black", size=0.5, alpha = .4) +
geom_vline(xintercept=5, linetype="dashed",color = "black", size=0.5, alpha = .4) +
coord_cartesian(xlim = c(0, 11))
print(g)
Tabela_Dinamica = df_todos_fiis %>%
dplyr::group_by(Setor) %>%
dplyr::summarise(
n = n(),
DY12m_median = median(DY12m, na.rm=TRUE),
MM200Delta_median = median(MM200Delta, na.rm=TRUE)
) %>% dplyr::filter(n >= 2) %>% dplyr::arrange(desc(MM200Delta_median)) %>% print(n = Inf)
print(Tabela_Dinamica)
df_todos_fiis
head(df_todos_fiis,1)
Tabela_Dinamica = df_todos_fiis %>%
dplyr::group_by(Setor) %>%
dplyr::summarise(
n = n(),
DY12m_median = median(DY12m, na.rm=TRUE),
MM200Delta_median = median(MM200Delta, na.rm=TRUE)
) %>% dplyr::filter(n >= 2) %>% dplyr::arrange(desc(MM200Delta_median)) %>% print(n = Inf)
knitr::opts_chunk$set(collapse = TRUE,
fig.retina = 2,
fig.align = 'center')
library(emo)
options(width = 180)
library(mt5R)
library(stringr)
library(dplyr)
MT5.Ping()
load("C:/Users/GKIN/Desktop/Blog/SuporteTempo.RData")
head(sTodosTickers)
length(sTodosTickers)
## Filtrar aqueles que verdadeiramente são FIIs
sTodosOsFIIs = sTodosTickers[bQuaisSaoFII]
head(sTodosOsFIIs)
length(sTodosOsFIIs)
PegarTextoNegrito = function(flat_html, sQualIndicador, iQualNaSequencia = 1)
{
# flat_html: é a página obtida pelo base::readLines
# sQualIndicador: qual indicador estamos atrás
# iQualNaSequencia: o indicador pode aparecer diversas vezes na pagina. Escolha em qual você está interessado.
iOnde_AproxIndicador = which(str_detect(flat_html, regex(sQualIndicador, ignore_case = T)))
iOnde_EstaoNegritos = which(str_detect(flat_html, "</strong>"))
sTexto = flat_html[iOnde_EstaoNegritos[iOnde_EstaoNegritos > iOnde_AproxIndicador[iQualNaSequencia]][1]]
iMarcadores = str_locate_all(sTexto, ">")[[1]][,1]
iOndeTermina = str_locate_all(sTexto, "</strong>")[[1]][1]
iOndeComeca = tail(subset(iMarcadores, iMarcadores < iOndeTermina),1)
sTexto_Quero = str_sub(sTexto, iOndeComeca + 1, iOndeTermina - 1)
if(length(sTexto_Quero)<1)sTexto_Quero = NA; ## não achou
return(sTexto_Quero)
}
PegarSetor = function(flat_html)
{
iOnde_AproxIndicador = which(str_detect(flat_html, regex(">Segmento</span>", ignore_case = T)))[1]
iOnde_BarraInversa = which(str_detect(flat_html, '\"'))
sTexto = flat_html[iOnde_BarraInversa[iOnde_BarraInversa > iOnde_AproxIndicador][1]]
iOnde_BarraDir = str_locate_all(sTexto, "/")[[1]]
## Procura por aspas
iOndeTermina = str_locate_all(sTexto, '"')[[1]][2]
iOnde_Comeca = tail(iOnde_BarraDir[iOnde_BarraDir < iOndeTermina],1)
sTexto_Quero = str_sub(sTexto, iOnde_Comeca + 1, iOndeTermina - 1)
return(sTexto_Quero)
}
scrape_url = "https://statusinvest.com.br/fundos-imobiliarios/xpml11"
flat_html = base::readLines(con = scrape_url, encoding="UTF-8")
PVP = PegarTextoNegrito(flat_html, "P/VP")
print(PVP)
Setor = PegarSetor(flat_html)
print(Setor)
## Poupar tempo na hora de ficar rodando toda vez na hora de criar a pagina
df_todos_fiis = df_todos_fiis_salvo1
head(df_todos_fiis)
df_todos_fiis = df_todos_fiis_salvo2
head(df_todos_fiis)
df_todos_fiis = df_todos_fiis_salvo3
df_todos_fiis = df_todos_fiis[!is.na(df_todos_fiis$Cotacao),]
df_todos_fiis$MM200Delta = scale(df_todos_fiis$MM200Delta, center = 0) * 100
head(df_todos_fiis)
Tabela_Dinamica = df_todos_fiis %>%
dplyr::group_by(Setor) %>%
dplyr::summarise(
n = n(),
DY12m_median = median(DY12m, na.rm=TRUE),
MM200Delta_median = median(MM200Delta, na.rm=TRUE)
) %>% dplyr::filter(n >= 2) %>% dplyr::arrange(desc(MM200Delta_median)) %>% print(n = Inf)
g = ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=1) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0.45, vjust=1.5) +
xlab('Dividend Yield') +
ylab('MM200Delta') +
geom_hline(yintercept=100, linetype="dashed",color = "black", size=0.5, alpha = .4) +
geom_vline(xintercept=5, linetype="dashed",color = "black", size=0.5, alpha = .4) +
coord_cartesian(xlim = c(0, 11))
print(g)
Tabela_Dinamica
save.image("C:/Users/GKIN/Desktop/Blog/SuporteTempo.RData")
knitr::opts_chunk$set(collapse = TRUE,
fig.retina = 2,
fig.align = 'center')
library(emo)
options(width = 180)
load("C:/Users/GKIN/Desktop/Blog/SuporteTempo.RData")
library(mt5R)
library(stringr)
library(dplyr)
MT5.Ping()
head(sTodosTickers)
length(sTodosTickers)
## Filtrar aqueles que verdadeiramente são FIIs
sTodosOsFIIs = sTodosTickers[bQuaisSaoFII]
head(sTodosOsFIIs)
length(sTodosOsFIIs)
PegarTextoNegrito = function(flat_html, sQualIndicador, iQualNaSequencia = 1)
{
# flat_html: é a página obtida pelo base::readLines
# sQualIndicador: qual indicador estamos atrás
# iQualNaSequencia: o indicador pode aparecer diversas vezes na pagina. Escolha em qual você está interessado.
iOnde_AproxIndicador = which(str_detect(flat_html, regex(sQualIndicador, ignore_case = T)))
iOnde_EstaoNegritos = which(str_detect(flat_html, "</strong>"))
sTexto = flat_html[iOnde_EstaoNegritos[iOnde_EstaoNegritos > iOnde_AproxIndicador[iQualNaSequencia]][1]]
iMarcadores = str_locate_all(sTexto, ">")[[1]][,1]
iOndeTermina = str_locate_all(sTexto, "</strong>")[[1]][1]
iOndeComeca = tail(subset(iMarcadores, iMarcadores < iOndeTermina),1)
sTexto_Quero = str_sub(sTexto, iOndeComeca + 1, iOndeTermina - 1)
if(length(sTexto_Quero)<1)sTexto_Quero = NA; ## não achou
return(sTexto_Quero)
}
PegarSetor = function(flat_html)
{
iOnde_AproxIndicador = which(str_detect(flat_html, regex(">Segmento</span>", ignore_case = T)))[1]
iOnde_BarraInversa = which(str_detect(flat_html, '\"'))
sTexto = flat_html[iOnde_BarraInversa[iOnde_BarraInversa > iOnde_AproxIndicador][1]]
iOnde_BarraDir = str_locate_all(sTexto, "/")[[1]]
## Procura por aspas
iOndeTermina = str_locate_all(sTexto, '"')[[1]][2]
iOnde_Comeca = tail(iOnde_BarraDir[iOnde_BarraDir < iOndeTermina],1)
sTexto_Quero = str_sub(sTexto, iOnde_Comeca + 1, iOndeTermina - 1)
return(sTexto_Quero)
}
scrape_url = "https://statusinvest.com.br/fundos-imobiliarios/xpml11"
flat_html = base::readLines(con = scrape_url, encoding="UTF-8")
PVP = PegarTextoNegrito(flat_html, "P/VP")
print(PVP)
Setor = PegarSetor(flat_html)
print(Setor)
## Poupar tempo na hora de ficar rodando toda vez na hora de criar a pagina
df_todos_fiis = df_todos_fiis_salvo1
head(df_todos_fiis)
df_todos_fiis = df_todos_fiis_salvo2
head(df_todos_fiis)
df_todos_fiis = df_todos_fiis_salvo3
df_todos_fiis = df_todos_fiis[!is.na(df_todos_fiis$Cotacao),]
df_todos_fiis$MM200Delta = scale(df_todos_fiis$MM200Delta, center = 0) * 100
head(df_todos_fiis)
Tabela_Dinamica = df_todos_fiis %>%
dplyr::group_by(Setor) %>%
dplyr::summarise(
n = n(),
DY12m_median = median(DY12m, na.rm=TRUE),
MM200Delta_median = median(MM200Delta, na.rm=TRUE)
) %>% dplyr::filter(n >= 2) %>% dplyr::arrange(desc(MM200Delta_median)) %>% print(n = Inf)
library(ggplot2)
g = ggplot(Tabela_Dinamica, aes(x=DY12m_median, y=MM200Delta_median)) +
geom_point(size=2, shape=1) +
geom_text(label=Tabela_Dinamica$Setor, hjust=0.45, vjust=1.5) +
xlab('Dividend Yield') +
ylab('MM200Delta') +
geom_hline(yintercept=100, linetype="dashed",color = "black", size=0.5, alpha = .4) +
geom_vline(xintercept=5, linetype="dashed",color = "black", size=0.5, alpha = .4) +
coord_cartesian(xlim = c(0, 11))
print(g)
blogdown::serve_site()
df_todos_fiis_salvo2[is.null(df_todos_fiis_salvo2$Vol)]
df_todos_fiis_salvo2[is.null(df_todos_fiis_salvo2$Vol),]
df_todos_fiis_salvo2[is.na(df_todos_fiis_salvo2$Vol),]
library(mt5R)
MT5.GetSymbol("BMII11", 1440, 5)
MT5.GetSymbol("BMII11", 1440, 5)
iCnt <- 0
while(TRUE)
{
Sys.sleep(0.01)
iCnt <- iCnt + 1
if(iCnt > iWait) return(NULL);
if(!file.exists(SFileDownloading))break;
}
Unprocessed_Table <- utils::read.table(sFile, sep = ';', col.names = c("Year", "Month", "Day", "Hour", "Minute", "Open", "High", "Low", "Close", "Volume"))
