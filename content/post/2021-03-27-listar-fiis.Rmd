---
title: "Listar FIIs como um supermercado"
author: "Guilherme Kinzel"
date: 2021-03-27T21:13:14-05:00
categories: ["R"]
tags: ["FII", "R", "Web scrapping"]
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE,
                      fig.retina = 2,
                      fig.align = 'center')
library(emo)
# options(encoding)
```

*J√° se imaginou dentro de um supermercado de FIIs?*


<center>
![](/images/supermarket.jpg){width=250px}
</center>

Passeando pelos corredores do setor de Log√≠stica, h√° nas prataleiras: 

+ **FII A** com 5,0% *Dividend Yield* e 20% do caixa dispon√≠vel e;
+ **FII B** com 6,0% *Dividend Yield* e 1% do caixa dispon√≠vel. 

Perceba que ao analisar a embalagem voc√™ facilmente pode mudar de opini√£o de qual produto levar para casa.

Aqui neste post do blog *I'm GK!* eu ajudarei voc√™ a fazer uma lista completa de todos os FIIs negoci√°veis na Bovespa, e quem escolhe as informa√ß√µes da embalagem √© voc√™!

*Este √© o primeiro post da s√©rie aposentadoria personalizada.*

## Introdu√ß√£o

Nesse post eu mostrarei e ensinarei fazer uma tabela de FIIs para voc√™ tomar as melhores decis√µes de investimento para forma√ß√£o de renda futura. Abaixo uma imagem exemplo de como ficar√° a nossa tabela com os indicadores escolhidos!

<center>
![](/images/tabelafiiex.png){width=400px}

<font size = "1">Aperte na imagem para aproximar</font>
</center>

Voc√™ pode visualizar a tabela completa [aqui](http://).

No final, utilizaremos o maquin√°rio do R para estudarmos os setores e tra√ßaremos gr√°ficos para melhor apoiarmos nossas decis√µes.

Caso voc√™ n√£o saiba o que seja um FII ‚ö†Ô∏è (fundo de investimento imobili√°rio) talvez esse n√£o seja um conte√∫do para voc√™ - ainda! Recomendo que estude um pouco mais sobre o assunto, pois n√£o abordaremos t√≥picos que outros j√° entraram em profundidade, por exemplo: como compr√°-los na corretora, o que s√£o rendimentos e etc.

## Indicadores

No nosso supermercado de FIIs somos n√≥s que escolhemos as embalagens! Escolheremos os indicadores que mais nos expressar√£o em poucas palavras - ou n√∫meros.

<font size = "2">

1. Ticker
2. Nome
3. Setor
4. Gestor
5. Cota√ß√£o
6. Volume m√©dio di√°rio
7. P/VP
8. MM200
9. √öltimo *Yield*
10. *Dividend Yield* 
11. Mediana *Yields (1M)* [^1]
12. Valor em caixa

</font>

Queremos ter uma boa id√©ia na hora de analisarmos as prateleiras: qual setor pertence? Quanto √© o seu P/VP? Vislumbrando de um todo, eventualmente poderemos prospectar mais afundo o FII para levarmos para adquirirmos e levar para casa.

#### Por que destes indicadores? 

*(cont√©m opini√µes pessoais)*

**Setor:** n√£o invista em FIIs que perten√ßam a setores com futuro nebuloso ou em que o inquilino tenha muito poder de negocia√ß√£o no contrato. Setores que na minha avalia√ß√£o s√£o de boa seguran√ßa para longo prazo, exemplos: residenciais, shoppings, papel (que seja bem diversificado), log√≠stica. Exemplos de n√£o seguros ou poder de negocia√ß√£o excessivo: ag√™ncias banc√°rias, hospitais. N√£o leve as minhas conclus√µes como suas tamb√©m, fa√ßa a sua pr√≥pria an√°lise!

**Gestor:** √© o DNA do FII. Assunto pouco abordado, pois quando √© comentado sobre diversifica√ß√£o √© mais discorrido sobre diversifica√ß√£o setorial. N√£o menospreze a informa√ß√£o de gestor ou de administrador, porque uma grande parcela dos FIIs entrega resultado aos diretamente envolvidos e n√£o aos cotistas. Fuja de FIIs que possuam DNA que n√£o seja voltado para voc√™ - o cotista.

**Volume m√©dio di√°rio:** voc√™ pode correr o risco de n√£o conseguir vender ou rotacionar os ativos em caso de oportunidades aparecerem. Sempre d√™ prefer√™ncia a FIIs de volume m√©dio di√°rio razo√°veis.

**P/VP:**[^2] m√©trica muito utilizada no mercado, entretanto, na minha avalia√ß√£o pessoal, este indicador √© *overrated* [^3]: simplifica excessivamente a avalia√ß√£o. Use-o com cautela, deixar de comprar FIIs que possuam P/VP > 1 pode levar voc√™ a perder √≥timas oportunidades.

**MM200:** a diferen√ßa entre o pre√ßo da cota e a m√©dia m√≥vel de 200 per√≠odos. Indicador excelente para saber quando a cota est√° "espichada" para cima, ou para baixo. Ser√° essencial para an√°lises em sintonia do *JdK RS-Momentum* do [RRG charts](https://www.relativerotationgraphs.com/), ou *relative rotational graphs*.

**Yields:** nosso foco ser√° montar uma carteira de renda para longo prazo e aqui est√° o que n√£o pode faltar na nossa embalagem. N√£o queremos saber se somente ele ir√° nos pagar bem, mas tamb√©m a sua regularidade. Usamos mediana ao inv√©s de m√©dia porque a primeira √© muito mais resistente a *outliers*, um FII pode dar um rendimento extremamente at√≠pico, e a avalia√ß√£o da m√©dia ficar√° descaracterizada por causa da amostra abrupta, j√° a mediana n√£o ser√° t√£o afetada - prefira mediana √† m√©dia nestas ocasi√µes. Perceba a diferen√ßa que a escolha dum *yield* adequado no exemplo abaixo:

Dois investidores come√ßam a montar sua aposentadoria personalizada, ambos com inicialmente $R\$ \text{ 5000}$ e depositam mensalmente $R\$ \text{ 500}$, reinvestem todo o valor com a mesma taxa de juros. Desconsidere o risco de reivestimento (n√£o conseguir investir a mesma taxa de juros).
<font size = "2">

* Investidor A preferiu pelo investimento com *Dividend Yield* de 5,0%.
* Investidor B preferiu pelo investimento com *Dividend Yield* de 6,0%.
</font>

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height = 2.4, fig.width = 5}
iMeses = 12 * 35
df_investidores = data.frame(iRow = seq_len(iMeses),
                             InvestidorA = rep(NA, length.out = iMeses), 
                             InvestidorB = rep(NA, length.out = iMeses))

fValorInicial = 5000
df_investidores$InvestidorA[1] = fValorInicial
df_investidores$InvestidorB[1] = fValorInicial

DY_A = (1.050) ^ (1/12)
DY_B = (1.060) ^ (1/12)

fAplicandoMensal = 500

for(i in 2:iMeses)
{
  df_investidores$InvestidorA[i] = df_investidores$InvestidorA[i-1] * DY_A + fAplicandoMensal
  df_investidores$InvestidorB[i] = df_investidores$InvestidorB[i-1] * DY_B + fAplicandoMensal
}

library(ggplot2)
library(ggrepel)

UltimaLinha = tail(df_investidores, 1)
UltimaLinha = as.data.frame(t(apply(UltimaLinha, 2, round, 0)))

g = ggplot(df_investidores, aes(x=iRow)) + 
    geom_line(aes(y = InvestidorA, color = "darkred")) + 
    geom_line(aes(y = InvestidorB, color = "steelblue")) + 
    xlab('Meses') +
    ylab('Dinheiro') + 
    scale_color_identity(name = "Investidor",
                       breaks = c("darkred", "steelblue"),
                       labels = c("5,0% DY", "6,0% DY"),
                       guide = "legend") +
    theme(legend.position = "top", legend.text = element_text(size = 10)) +
    geom_text_repel(aes(label = format(round(InvestidorA, 0), nsmall=0, big.mark=".", decimal.mark = ","), 
                      y = InvestidorA), data = UltimaLinha, color = "darkred") +
    geom_text_repel(aes(label = format(round(InvestidorB, 0), nsmall=0, big.mark=".", decimal.mark = ","), 
                      y = InvestidorB), data = UltimaLinha, color= "steelblue")

print(g)
```

A diferen√ßa percentual entre as aposentadorias √© aproximadamente de $\frac{721}{578} = 1,24 \to 24\%$. Perceba que a curva do investidor B se descola do investidor A, e tamb√©m estamos falando de 143 mil reais de diferen√ßa!

A boa not√≠cia √© que na tabela que iremos gerar voc√™ ir√° descobrir que h√° FIIs que pagam bem mais do que os *Dividend Yield* apresentados! Removendo aqueles que n√£o est√£o pagando *Dividend Yield* por algum motivo em especial, enquanto escrevo esse post, a mediana de *Dividend Yield* dos FIIs restantes (220 FIIs) √© de 6,12%. üöÄ

**Valor em caixa:** nosso √∫ltimo par√¢metro √© para avaliar o espa√ßo de manobra do FII. Perceba que o FII que h√° recurso financeiro de sobra por muito tempo √© sin√¥nimo de inefici√™ncia do gestor, alguns FIIs at√© consideram n√£o cobrar taxa de performance quando o cen√°rio ocorre.

Valores que n√£o foram encontrados no site s√£o denotados como `NA` na tabela.

## Kair√≥s

*Kair√≥s foi na mitologia grega o deus do tempo oportuno, hoje tamb√©m referido como "medida certa".* 

Se voc√™ n√£o √© usu√°rio da linguagem R e somente quer usar o conte√∫do explicado para gerar suas tabelas periodicamente, veja abaixo:

* Como instalar o R + RStudio + MT5 + mt5R.
* Como rodar o c√≥digo para listar todos os FIIs.

Pronto! Espero que eu tenha ajudado as suas decis√µes de investimento! ‚ù§Ô∏è

Mas se voc√™ quer programar as suas pr√≥prias *embalagens*, continue lendo! Vaamos! ‚õè 

## As ferramentas

* R + RStudio
* MT5
* mt5R

Faremos uso de t√©cnicas de [web scrapping](https://en.wikipedia.org/wiki/Web_scraping) nos seguintes sites:

* https://www.statusinvest.com.br/
* https://www.fundamentus.com.br/

Dois excelentes sites que eu recomendo muito! 

Voc√™ pode acessar o c√≥digo R completo que ser√° usado [aqui](http://).

## O come√ßo

```{r echo=T, message=FALSE, warning=FALSE, results='hide'}
library(mt5R)
library(stringr) ## Pacote muito bom para processar strings

## Pegaremos o Ticker de todos os ativos negociaveis na B3
sTodosTickers = MT5.AllSymbols() 

## Queremos somente aqueles que possuam '11' no nome 
sTodosTickers = sTodosTickers[str_detect(sTodosTickers, "11")] 

## Podem vir op√ß√µes junto, tiramos pelo tamanho do nome
sTodosTickers = sTodosTickers[str_length(sTodosTickers) >= 5 & str_length(sTodosTickers) <= 6] 
```

Vamos dar uma espiada nos tickers candidatos, que provavelmente s√£o FIIs.

```{r}
head(sTodosTickers)

length(sTodosTickers)
```
Percebam que h√° outros ativos que n√£o FIIs que tamb√©m foram contemplados, percebam no **BBAS11** acima. Em seguida temos a quantidade dos nossos candidatos usando `length(sTodosTickers)`.

Iremos de *ticker* em *ticker* com ajuda da p√°gina [statusinvest](https://www.statusinvest.com.br/) para saber se o mesmo √© um FII. Caso a p√°gina retorne que o *ticker* informado n√£o foi encontrado o retiraremos da lista.

Veja [aqui](https://statusinvest.com.br/fundos-imobiliarios/paginanaoencontrou) a p√°gina do [statusinvest](https://www.statusinvest.com.br/) quando o FII n√£o √© encontrado.


```{R, include = F}
load("C:/Users/GKIN/Desktop/Blog/SuporteTempo.RData")
```

```{r, eval = F}
## Criaremos um vetor para armazenar se √© realmente FII
bQuaisSaoFII = rep(TRUE, length.out = length(sTodosTickers))

for(i in 1:length(sTodosTickers))
{
  ## Iremos de nome em nome
  sAtivo = sTodosTickers[i]
  
  ## Colocaremos tudo em min√∫scula para inserir na url
  sAtivo = str_to_lower(sAtivo)
  
  scrape_url <- paste0("https://statusinvest.com.br/fundos-imobiliarios/", sAtivo)
  flat_html <- base::readLines(con = scrape_url, encoding="UTF-8")
  
  ## Verificar se realmente √© FII
  if(any(str_detect(flat_html, "o encontramos o que vo") == T))
  {
    ## Se o statusinvest.com.br informar que n√£o encontrou o ticker
    bQuaisSaoFII[i] = FALSE
  }else
  {
    ## Caso contr√°rio, √© FII!
    bQuaisSaoFII[i] = TRUE
  }
}
```

Vamos dar uma espiada nos *tickers* que sobraram.

```{r}
## Filtrar aqueles que verdadeiramente s√£o FIIs
sTodosOsFIIs = sTodosTickers[bQuaisSaoFII]

head(sTodosOsFIIs)

length(sTodosOsFIIs)
```

A primeira parte foi realizada com sucesso! Temos agora o *ticker* de todos os FIIs dispon√≠veis!

Qual




[^1]: *Dividend Yield* em sua defini√ß√£o √© sempre em janela anual (12M), *Dividend Yield (1M)* √© cria√ß√£o do autor.
[^2]: $\text{P/VP} = \frac{\text{Valor da cota}}{\text{Valor patrimonial}}$
[^3]: Sobrestimado. N√£o possui tanto valor como √© normalmente divulgado.