---
title: Teste 5
author: Guilherme Kinzel
date: '2021-03-22'
slug: []
categories: []
tags: []
Description: ''
Tags: []
Categories: []
DisableComments: no
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE,
                      fig.retina = 2,
                      fig.align = 'center',
                      comment = "#>")
library(emo)
options(width = 180)
load("C:/Users/GKIN/Desktop/Blog/SuporteTempo.RData")
```

*J√° se imaginou dentro de um supermercado de FIIs?*

P√°gina ainda em constru√ß√£o. Ainda n√£o divulgada. üößüë∑üõ†üöß

<center>
![](/images/supermarket.jpg){width=250px}
</center>
<style type="text/css">

body, td {
   font-size: 14px;
}
code.r{
  font-size: 20px;
}
pre {
  font-size: 13px
}
</style>
Passeando pelos corredores do setor de Log√≠stica, h√° nas prataleiras: 

+ **FII A** com 5,0% *Dividend Yield* e 20% do caixa dispon√≠vel e;
+ **FII B** com 6,0% *Dividend Yield* e 1% do caixa dispon√≠vel. 

Perceba que ao analisar a embalagem voc√™ facilmente pode mudar de opini√£o de qual produto levar para casa.

Aqui neste post do blog *I'm GK!* eu ajudarei voc√™ a fazer uma lista completa de todos os FIIs negoci√°veis na Bovespa, e quem escolhe as informa√ß√µes da embalagem √© voc√™!

## Introdu√ß√£o

Eu lembro que ap√≥s terminada a leitura do livro do Marcelo Fayh sobre FIIs eu pensei: *certo, agora como vou ach√°-los?* A principal vantagem de quando elaborei a tabela pela primeira vez foi ter em m√£os a lista de todos os FIIs negoci√°veis, porque eu pensava: procurando no YouTube ou em sites especializados eu sei da exist√™ncia FII A, B, C - mas ser√£o todos? Eu quero saber de todos!

E se existir um FII que estivesse fazendo uma diferen√ßa para voc√™, mas voc√™ n√£o est√° vendo-o?

Mas com o motor do `R` para nos auxiliar, n√£o nos contentaremos somente com a lista de todos os FIIs negoci√°veis. Vamos para os indicadores deles tamb√©m! Vamos montar nosso supermercado de FIIs! Veja abaixo:

<center>
![](/images/tabelafiiexformt.png){width=400px}

<font size = "1">Aperte na imagem para aproximar</font>
</center>

Voc√™ pode visualizar a tabela completa [aqui](https://github.com/Kinzel/Kinzel.github.io/raw/master/content/files/tabela_fiis.xlsx).

**Embalagem dos FIIs**

No nosso supermercado de FIIs somos n√≥s que escolhemos as embalagens! Escolheremos os indicadores abaixo:

<font size = "2">

1. Ticker
2. Nome
3. Setor
4. Administrador
5. Cota√ß√£o
6. MM200Delta[^1]
7. Volume m√©dio di√°rio (em milh√µes)
8. *Dividend Yield* 
9. P/VP
10. Valor em caixa
11. Payback (anos)

</font>

*MM200Delta:* medir o quanto a cota est√° "espichada" para cima ou para baixo. √â usado m√©dia m√≥vel de 200 per√≠odos. Quanto maior o indicador, mais a cota subiu recentemente. Usaremos metodologia an√°loga ao JdK RS-Momentum usado no [Relative Rotation Graphs (RRG)](https://www.relativerotationgraphs.com/). Quanto menor, melhor.

*Payback (anos):* payback em anos de quanto voc√™ recuperaria o valor do valor da cota com os rendimentos do FII adquirido. Medida simplista, n√£o √© medido com reinvestimento e √© dado como premissa que o *dividend yield* √© constante durante o per√≠odo. Quanto menor, melhor.

## Kair√≥s

*Kair√≥s foi na mitologia grega o deus do tempo oportuno, hoje tamb√©m referido como "medida certa".* 

N√≥s iniciaremos nosso caminho pela programa√ß√£o `R`, mas se voc√™ n√£o √© usu√°rio da linguagem e somente quer usar o conte√∫do demonstrado no artigo para gerar as suas tabelas periodicamente, veja abaixo:

* Veja este v√≠deo [aqui]() para instalar o R + RStudio + MT5 + mt5R. (7min) ##TODO
* Veja este v√≠deo [aqui]() de X minutos para rodar o c√≥digo sem saber de `R`. (4min) ##TODO

Pronto! Espero que eu tenha ajudado as suas decis√µes de investimento! ‚ù§Ô∏è

Mas se voc√™ quer programar as suas pr√≥prias *embalagens*, continue lendo! ‚õè 

## As ferramentas

* R + RStudio
* MT5
* mt5R (0.1.5 ou superior)

Faremos uso de t√©cnicas de [web scrapping](https://en.wikipedia.org/wiki/Web_scraping) nos seguintes sites:

* https://www.statusinvest.com.br/
* https://www.clubefii.com.br/

Dois excelentes sites que eu recomendo muito! 

Voc√™ pode acessar o c√≥digo `R` completo que ser√° usado [aqui](https://raw.githubusercontent.com/Kinzel/Kinzel.github.io/master/content/files/SupermercadoFIIs.R).

## O come√ßo

O nosso *pipeline* est√° resumidamente abaixo. A ferramenta e a informa√ß√£o que iremos obter.

1. mt5R: *ticker*
2. Web scraping: verificar quem √© FII pelo *statusinvest*
3. Web scraping: setor, administrador, DY12m, P/VP e valor em caixa pelo *statusinvest*
4. mt5R: cota√ß√£o, MM200Delta e Volume
5. Web scrapping: nome do FII pelo *clubefii*

Vamos come√ßar! Carregaremos os pacotes que ser√£o usados.

```{r echo=T, message=FALSE, warning=FALSE, results='hide'}
library(mt5R)
library(stringr) 
library(dplyr)
```

Verificamos se o mt5R est√° no MT5:

```{r}
MT5.Ping()
```

### 1. mt5R: ticker

Aqui iremos somente extrair os *tickers* candidatos (possivelmente FIIs) do MetaTrader 5, usando `MT5.AllSymbols()`.

```{r echo=T, message=FALSE, warning=FALSE, results='hide', eval = FALSE}
## Pegaremos o Ticker de todos os ativos negociaveis na B3
sTodosTickers = MT5.AllSymbols() 

## Queremos somente aqueles que possuam '11' no nome 
sTodosTickers = sTodosTickers[str_detect(sTodosTickers, "11")] 

## Podem vir op√ß√µes junto, tiramos pelo tamanho do nome
sTodosTickers = sTodosTickers[str_length(sTodosTickers) >= 5 & str_length(sTodosTickers) <= 6] 
```

Vamos dar uma espiada nos *tickers* candidatos que provavelmente s√£o FIIs.